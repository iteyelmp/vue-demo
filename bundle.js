!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){var r,o;window,e.exports=(r=n(1),o=n(2),function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=r},function(e,t){e.exports=o},function(e,t,n){"use strict";n.r(t);var r,o,a,s,i,c=n(1),u=n.n(c),l=n(0);function d(e){for(var t=[],n=0;n<e.byteLength;n++){var r=e.getUint8(n);t.push(r)}return t}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"default",(function(){return v}));var v=function(e){function t(e,n,r,c,u){var l,p;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),l=!(p=g(t).call(this,e,n,r,c,u))||"object"!==f(p)&&"function"!=typeof p?y(this):p,b(y(l),"sendCommandToCard",(function(e){return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(o.writeValue(new Uint8Array(e)));case 2:case"end":return t.stop()}}))})),b(y(l),"sendDataToCard",(function(e){return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(a.writeValue(new Uint8Array(e)));case 2:case"end":return t.stop()}}))})),b(y(l),"checkCardStatus",(function(){var e;return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(s.readValue());case 2:return e=t.sent,t.abrupt("return",d(e)[0]);case 4:case"end":return t.stop()}}))})),b(y(l),"readDataFromCard",(function(){var e;return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(i.readValue());case 2:return e=t.sent,t.abrupt("return",d(e));case 4:case"end":return t.stop()}}))})),l}var n,c,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,e),n=t,u=[{key:"isSupported",value:function(){var e;return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(navigator.bluetooth.getAvailability());case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}))}},{key:"listen",value:function(e){var t,n;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,t=Object(l.getBluetoothServiceUuids)(),r.next=4,regeneratorRuntime.awrap(navigator.bluetooth.requestDevice({filters:[{services:t}]}));case 4:n=r.sent,e(null,n),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(0),e(r.t0,null);case 11:case"end":return r.stop()}}),null,null,[[0,8]])}},{key:"connect",value:function(e){var n,c,u,d;return regeneratorRuntime.async((function(f){for(;;)switch(f.prev=f.next){case 0:return e.addEventListener("gattserverdisconnected",this._onDeviceDisconnect),f.next=3,regeneratorRuntime.awrap(e.gatt.connect());case 3:return r=f.sent,console.debug("".concat(e.name," connected")),f.next=7,regeneratorRuntime.awrap(r.getPrimaryServices());case 7:return n=f.sent,c=n[0],u=Object(l.getInfosForServiceUuid)(c.uuid),f.next=12,regeneratorRuntime.awrap(c.getCharacteristic(u.writeUuid));case 12:return o=f.sent,f.next=15,regeneratorRuntime.awrap(c.getCharacteristic(u.dataUuid));case 15:return a=f.sent,f.next=18,regeneratorRuntime.awrap(c.getCharacteristic(u.checkUuid));case 18:return s=f.sent,f.next=21,regeneratorRuntime.awrap(c.getCharacteristic(u.readUuid));case 21:return i=f.sent,d=new t(e,this.sendCommandToCard,this.sendDataToCard,this.checkCardStatus,this.readDataFromCard),f.abrupt("return",d);case 24:case"end":return f.stop()}}),null,this)}},{key:"disconnect",value:function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=3;break}return e.next=3,regeneratorRuntime.awrap(r.disconnect());case 3:r=void 0,o=void 0,a=void 0,s=void 0,i=void 0;case 8:case"end":return e.stop()}}))}},{key:"setOnDisconnect",value:function(e,t){e.addEventListener("gattserverdisconnected",t)}}],(c=[{key:"_onDeviceDisconnect",value:function(e){return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:console.debug("Device "+e.target.name+" is disconnected.");case 1:case"end":return t.stop()}}))}}])&&p(n.prototype,c),u&&p(n,u),t}(u.a)}]))},function(e,t,n){window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(n,!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(t),n.d(t,"getBluetoothServiceUuids",(function(){return g})),n.d(t,"getInfosForServiceUuid",(function(){return y}));var s={cws:{id:"cws",productName:"CoolWallets",bluetoothSpec:[{serviceUuid:"0000a000-0000-1000-8000-00805f9b34fb",writeUuid:"0000a007-0000-1000-8000-00805f9b34fb",dataUuid:"0000a008-0000-1000-8000-00805f9b34fb",checkUuid:"0000a006-0000-1000-8000-00805f9b34fb",readUuid:"0000a009-0000-1000-8000-00805f9b34fb"}]}},i=[],c={};for(var u in s){var l=s[u],d=l.bluetoothSpec;if(d)for(var f=0;f<d.length;f++){var p=d[f];i.push(p.serviceUuid),c[p.serviceUuid]=c[p.serviceUuid.replace(/-/g,"")]=o({deviceModel:l},p)}}var g=function(){return i},y=function(e){return c[e.toLowerCase()]}}])},function(e,t,n){var r;window,e.exports=(r=n(4),function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=r},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=n(0);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t,n,o,a,s){var i,c,u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),c=function(e,t){var n;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,regeneratorRuntime.awrap(Object(r.sendAPDU)(u.sendCommandToCard,u.sendDataToCard,u.checkCardStatus,u.readDataFromCard,e,t));case 2:return n=o.sent,o.abrupt("return",n);case 4:case"end":return o.stop()}}))},(i="request")in this?Object.defineProperty(this,i,{value:c,enumerable:!0,configurable:!0,writable:!0}):this[i]=c,this.device=t,this.sendCommandToCard=this.sendCommandToCard.bind(this),this.sendDataToCard=this.sendDataToCard.bind(this),this.checkCardStatus=this.checkCardStatus.bind(this),this.readDataFromCard=this.readDataFromCard.bind(this)}var t,n,a;return t=e,a=[{key:"isSupported",value:function(){throw new Error("not implemented")}},{key:"listen",value:function(e){throw new Error("not implemented")}},{key:"connect",value:function(e){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("not implemented");case 1:case"end":return e.stop()}}))}},{key:"disconnect",value:function(e){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("not implemented");case 1:case"end":return e.stop()}}))}},{key:"setOnDisconnect",value:function(e,t){throw new Error("not implemented")}}],(n=[{key:"sendCommandToCard",value:function(e){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("not implemented");case 1:case"end":return e.stop()}}))}},{key:"sendDataToCard",value:function(e){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("not implemented");case 1:case"end":return e.stop()}}))}},{key:"checkCardStatus",value:function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("not implemented");case 1:case"end":return e.stop()}}))}},{key:"readDataFromCard",value:function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("not implemented");case 1:case"end":return e.stop()}}))}}])&&o(t.prototype,n),a&&o(t,a),e}()}]))},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r);var a=class{constructor(){this.listenFromIframe()}listenFromIframe(){window.addEventListener("message",async e=>{if(console.log("-----listenFromIframe-----",e),e&&e.data&&"LEDGER-IFRAME"===e.data.target){const{action:t,params:n}=e.data,r=t+"-reply";({"ledger-import":()=>this.import(r,n.hdPath),"ledger-unlock":()=>this.unlock(r,n.hdPath),"ledger-getAddress":()=>this.getAddress(r),"ledger-getAppConfiguration":()=>this.getAppConfiguration(r),"ledger-sign-transaction":()=>this.signTransaction(r,n.hdPath,n.serializedTxHex),"ledger-sign-personal-message":()=>this.signPersonalMessage(r,n.hdPath,n.message),undefined:()=>{}})[t]()}else console.log("not collwallet-iframe",e)},!1)}sendMessageToExtension(e){window.parent.postMessage(e,"*")}async initApp(){try{console.log("initApp"),o.a.listen(async(e,t)=>{if(console.log("device",t),!t)throw e;this.transport=await o.a.connect(t),console.log("transport",transport)})}catch(e){console.log("COLLWALLET:::CREATE APP ERROR",e)}}cleanUp(){}async import(e,t){console.log("----import-----");try{o.a.listen(async(t,n)=>{if(!n)throw t;{console.log("----import-----device",n),this.transport=await o.a.connect(n),console.log("transport",transport);const t="0xC85d47b72cA69D2342426C7F1b0930a80178667C";this.sendMessageToExtension({action:e,success:!0,payload:t})}})}catch(t){console.log("----import-----error",t);const n=this.ledgerErrToMessage(t);this.sendMessageToExtension({action:e,success:!1,payload:{error:n.toString()}})}finally{this.cleanUp()}}async unlock(e,t){try{await this.initApp();const t="";this.sendMessageToExtension({action:e,success:!0,payload:t})}catch(t){const n=this.ledgerErrToMessage(t);this.sendMessageToExtension({action:e,success:!1,payload:{error:n.toString()}})}finally{this.cleanUp()}}async getAddress(e){try{await this.initApp();const{address:t}=await this.app.getAddress()||{};this.sendMessageToExtension({action:e,success:!0,payload:t})}catch(t){const n=this.ledgerErrToMessage(t);this.sendMessageToExtension({action:e,success:!1,payload:{error:n.toString()}})}finally{this.cleanUp()}}async getAppConfiguration(e){try{await this.initApp();const t={};this.sendMessageToExtension({action:e,success:!0,payload:t})}catch(t){const n=this.ledgerErrToMessage(t);this.sendMessageToExtension({action:e,success:!1,payload:{error:n.toString()}})}finally{this.cleanUp()}}async signTransaction(e,t,n){try{await this.initApp();const t="";this.sendMessageToExtension({action:e,success:!0,payload:t})}catch(t){const n=this.ledgerErrToMessage(t);this.sendMessageToExtension({action:e,success:!1,payload:{error:n.toString()}})}finally{this.cleanUp()}}async signPersonalMessage(e,t,n){try{await this.initApp();const t="";this.sendMessageToExtension({action:e,success:!0,payload:t})}catch(t){const n=this.ledgerErrToMessage(t);this.sendMessageToExtension({action:e,success:!1,payload:{error:n.toString()}})}finally{this.cleanUp()}}ledgerErrToMessage(e){return(e=>!!e&&!!e.metaData)(e)?5===e.metaData.code?"LEDGER_TIMEOUT":e.metaData.type:(e=>"string"==typeof e)(e)?e.includes("6804")?"LEDGER_WRONG_APP":e.includes("6801")?"LEDGER_LOCKED":e:(e=>e.hasOwnProperty("id")&&e.hasOwnProperty("message"))(e)&&e.message.includes("U2F not supported")?"U2F_NOT_SUPPORTED":e.toString()}};(async()=>{const e=new a;console.log("CoolWalletBridge",e)})(),console.log("QuarkChain < === > CoolWallet Bridge initialized!")},function(e,t,n){"use strict";n.r(t),n.d(t,"sendAPDU",(function(){return u}));let r,o=!1,a={};const s=async(e,t,n=0)=>{if(0===t.length)return;const r=((e,t)=>{const n=18*e,r=18*(e+1);return t.slice(n,r)})(n,t);return console.debug("_sendDataToCard data",r),await e([n+1,r.length,...r]),((e,t)=>18*e>t.length)(n+1,t)?void 0:s(e,t,n+1)},i=async(e,t="")=>{const n=await e(),r=l(n);return console.debug("_readDataFromCard resultData",r),"fc"===r?t:i(e,t+r.slice(4))},c=async(e,t)=>{if(clearTimeout(r),o)return;const n=await e();if(console.debug("_checkCardStatus status",n),0===n){o=!0;try{const e=await i(t);a.resolve(e)}catch(e){a.reject(e)}a=null}else r=setTimeout(()=>{c(e,t)},1e3)},u=async(e,t,n,r,i,u)=>{const l=f(i);await e(l);const d=f(u);d&&d.length>0&&await s(t,d),o=!1;return await((e,t)=>new Promise((n,r)=>{a={resolve:n,reject:r},c(e,t)}))(n,r)},l=e=>e.map(e=>d(e)).join(""),d=e=>(e<16?"0":"")+e.toString(16),f=e=>{if(!e)return[];let t=[],n=e.length;for(let r=0;r<n;r+=2)t.push(parseInt(e.substr(r,2),16));return t}}]);